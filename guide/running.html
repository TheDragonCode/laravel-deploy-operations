<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.18" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (userMode === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (userMode === 'dark' || systemDarkMode) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <meta property="og:url" content="https://deploy-operations.dragon-code.pro/guide/running.html"><meta property="og:site_name" content="Laravel Deploy Operations"><meta property="og:title" content="Running Operations"><meta property="og:description" content="Running Operations To run all of your outstanding operations, execute the operations artisan command: The order in which operations are called is checked by file name in alphabe..."><meta property="og:type" content="article"><meta property="og:locale" content="en-US"><meta property="og:updated_time" content="2024-05-22T20:24:51.000Z"><meta property="article:modified_time" content="2024-05-22T20:24:51.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Running Operations","image":[""],"dateModified":"2024-05-22T20:24:51.000Z","author":[]}</script><link rel="icon" href="https://deploy-operations.dragon-code.pro/images/logo.svg"><title>Running Operations | Laravel Deploy Operations</title><meta name="description" content="Running Operations To run all of your outstanding operations, execute the operations artisan command: The order in which operations are called is checked by file name in alphabe...">
    <link rel="preload" href="/assets/style-DScQzVZ8.css" as="style"><link rel="stylesheet" href="/assets/style-DScQzVZ8.css">
    <link rel="modulepreload" href="/assets/app-DbZK4p7a.js"><link rel="modulepreload" href="/assets/running.html-N_msl3OB.js">
    <link rel="prefetch" href="/assets/index.html-DwKTPCnS.js" as="script"><link rel="prefetch" href="/assets/database-data-dumper.html-BuMRa-z8.js" as="script"><link rel="prefetch" href="/assets/installation.html-DOPMiGSo.js" as="script"><link rel="prefetch" href="/assets/basic.html-CiK9s15G.js" as="script"><link rel="prefetch" href="/assets/creating.html-JnhIkMYz.js" as="script"><link rel="prefetch" href="/assets/customize-stub.html-CbdpRNrV.js" as="script"><link rel="prefetch" href="/assets/rollback.html-CQaDAaE4.js" as="script"><link rel="prefetch" href="/assets/status.html-DM6e5PlZ.js" as="script"><link rel="prefetch" href="/assets/artisan.html-DbIB7cqk.js" as="script"><link rel="prefetch" href="/assets/events.html-CBpK1C3k.js" as="script"><link rel="prefetch" href="/assets/execution-status.html-DeupbCjM.js" as="script"><link rel="prefetch" href="/assets/3.x.html-CaJEBeEi.js" as="script"><link rel="prefetch" href="/assets/4.x.html-tMO3lny9.js" as="script"><link rel="prefetch" href="/assets/5.x.html-BZVOe6V4.js" as="script"><link rel="prefetch" href="/assets/6.x.html-DY9RogRt.js" as="script"><link rel="prefetch" href="/assets/index.html-D6mopW5f.js" as="script"><link rel="prefetch" href="/assets/404.html-hvmn-GXk.js" as="script"><link rel="prefetch" href="/assets/setupDevtools-7MC2TMWH-D7pOKwvl.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/"><img class="vp-site-logo" src="https://deploy-operations.dragon-code.pro/images/logo.svg" alt="Laravel Deploy Operations"><span class="vp-site-name vp-hide-mobile" aria-hidden="true">Laravel Deploy Operations</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="6.x"><span class="title">6.x</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="6.x"><span class="title">6.x</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/getting-started/installation.html" aria-label="6.x"><!---->6.x<!----></a></li><li class="vp-navbar-dropdown-item"><a class="auto-link external-link" href="https://github.com/TheDragonCode/laravel-deploy-operations/blob/5.x/docs/index.md" aria-label="5.x" rel="noopener noreferrer" target="_blank"><!---->5.x<!----></a></li><li class="vp-navbar-dropdown-item"><a class="auto-link external-link" href="https://github.com/TheDragonCode/laravel-deploy-operations/blob/4.x/docs/index.md" aria-label="4.x" rel="noopener noreferrer" target="_blank"><!---->4.x<!----></a></li><li class="vp-navbar-dropdown-item"><a class="auto-link external-link" href="https://github.com/TheDragonCode/laravel-deploy-operations/blob/3.x/docs/index.md" aria-label="3.x" rel="noopener noreferrer" target="_blank"><!---->3.x<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/TheDragonCode/laravel-deploy-operations" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!---->GitHub<!----></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="6.x"><span class="title">6.x</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="6.x"><span class="title">6.x</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/getting-started/installation.html" aria-label="6.x"><!---->6.x<!----></a></li><li class="vp-navbar-dropdown-item"><a class="auto-link external-link" href="https://github.com/TheDragonCode/laravel-deploy-operations/blob/5.x/docs/index.md" aria-label="5.x" rel="noopener noreferrer" target="_blank"><!---->5.x<!----></a></li><li class="vp-navbar-dropdown-item"><a class="auto-link external-link" href="https://github.com/TheDragonCode/laravel-deploy-operations/blob/4.x/docs/index.md" aria-label="4.x" rel="noopener noreferrer" target="_blank"><!---->4.x<!----></a></li><li class="vp-navbar-dropdown-item"><a class="auto-link external-link" href="https://github.com/TheDragonCode/laravel-deploy-operations/blob/3.x/docs/index.md" aria-label="3.x" rel="noopener noreferrer" target="_blank"><!---->3.x<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/TheDragonCode/laravel-deploy-operations" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!---->GitHub<!----></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">Getting Started <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/" aria-label="Introduction"><!---->Introduction<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/getting-started/installation.html" aria-label="Installation"><!---->Installation<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/guide/basic.html" aria-label="Basic Usage"><!---->Basic Usage<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/upgrade-guide/" aria-label="Upgrade Guide"><!---->Upgrade Guide<!----></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading active">Guide <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link route-link-active auto-link vp-sidebar-item active" href="/guide/running.html" aria-label="Running Operations"><!---->Running Operations<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/guide/creating.html" aria-label="Creating Operations"><!---->Creating Operations<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/guide/status.html" aria-label="Operations Status"><!---->Operations Status<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/guide/rollback.html" aria-label="Rolling Back Operations"><!---->Rolling Back Operations<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/guide/customize-stub.html" aria-label="Customize Stub"><!---->Customize Stub<!----></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">Helpers <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/helpers/artisan.html" aria-label="Artisan Command"><!---->Artisan Command<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/helpers/events.html" aria-label="Events"><!---->Events<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/helpers/execution-status.html" aria-label="Execution Status"><!---->Execution Status<!----></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">Extras <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/extras/database-data-dumper.html" aria-label="Database Dumper"><!---->Database Dumper<!----></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div class="theme-default-content" vp-content><!--[--><!--]--><div><h1 id="running-operations" tabindex="-1"><a class="header-anchor" href="#running-operations"><span>Running Operations</span></a></h1><p>To run all of your outstanding operations, execute the <code>operations</code> artisan command:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">php artisan operations</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>The order in which operations are called is checked by file name in alphabetical order, without taking into account directory names:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># actual file names</span></span>
<span class="line">2022_10_14_000001_test1      <span class="token comment"># 1</span></span>
<span class="line">2022_10_14_000004_test4      <span class="token comment"># 4</span></span>
<span class="line">bar/2022_10_14_000003_test3  <span class="token comment"># 3</span></span>
<span class="line">foo/2022_10_14_000002_test2  <span class="token comment"># 2</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># order of running operations at startup</span></span>
<span class="line">2022_10_14_000001_test1      <span class="token comment"># 1</span></span>
<span class="line">foo/2022_10_14_000002_test2  <span class="token comment"># 2</span></span>
<span class="line">bar/2022_10_14_000003_test3  <span class="token comment"># 3</span></span>
<span class="line">2022_10_14_000004_test4      <span class="token comment"># 4</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="isolating-operations-execution" tabindex="-1"><a class="header-anchor" href="#isolating-operations-execution"><span>Isolating Operations Execution</span></a></h2><p>If you are deploying your application across multiple servers and running operations as part of your deployment process, you likely do not want two servers attempting to run the database at the same time. To avoid this, you may use the <code>isolated</code> option when invoking the <code>operations</code> command.</p><p>When the <code>isolated</code> option is provided, Laravel will acquire an atomic lock using your application&#39;s cache driver before attempting to run your operations. All other attempts to run the <code>operations</code> command while that lock is held will not execute; however, the command will still exit with a successful exit status code:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">php artisan operations <span class="token parameter variable">--isolated</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="split-launch-option" tabindex="-1"><a class="header-anchor" href="#split-launch-option"><span>Split Launch Option</span></a></h2><p>Sometimes it becomes necessary to launch operations separately, for example, to notify about the successful deployment of a project.</p><p>There is a <code>before</code> option for this when calling operations:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">php artisan operations <span class="token parameter variable">--before</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>When calling the <code>operations</code> command with the <code>before</code> parameter, the script will execute only those operations within which the value of the <code>before</code> parameter is <code>true</code>.</p><p>For backwards compatibility, the <code>before</code> parameter is set to <code>true</code> by default, but operations will only be executed if the option is explicitly passed.</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token keyword">use</span> <span class="token package">DragonCode<span class="token punctuation">\</span>LaravelDeployOperations<span class="token punctuation">\</span>Operation</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token keyword">class</span> <span class="token class-name-definition class-name">extends</span> <span class="token class-name">Operation</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">protected</span> <span class="token keyword type-declaration">bool</span> <span class="token variable">$before</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">void</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// some code</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>For example, you need to call operations when deploying an application. Some operations should be run after the operations are deployed, and others after the application is fully launched.</p><p>To run, you need to pass the <code>before</code> parameter. For example, when using <a href="https://github.com/deployphp/deployer" target="_blank" rel="noopener noreferrer"><code>deployer</code></a> it would look like this:</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token function">task</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;deploy&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token comment">// ...</span></span>
<span class="line">    <span class="token string single-quoted-string">&#39;artisan:migrate&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string single-quoted-string">&#39;artisan:operation --before&#39;</span><span class="token punctuation">,</span> <span class="token comment">// here</span></span>
<span class="line">    <span class="token string single-quoted-string">&#39;deploy:publish&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string single-quoted-string">&#39;php-fpm:reload&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string single-quoted-string">&#39;artisan:queue:restart&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string single-quoted-string">&#39;artisan:operations&#39;</span><span class="token punctuation">,</span> <span class="token comment">// here</span></span>
<span class="line"><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Thus, when <code>operations</code> is called, all operations whose <code>before</code> parameter is <code>true</code> will be executed, and after that, the remaining tasks will be executed.</p><blockquote><p>Note: If you call the <code>operations</code> command without the <code>before</code> parameter, then all tasks will be executed regardless of the value of the <code>$before</code> attribute inside the operation class.</p></blockquote><h2 id="forcing-operations-to-run-in-production" tabindex="-1"><a class="header-anchor" href="#forcing-operations-to-run-in-production"><span>Forcing Operations To Run In Production</span></a></h2><blockquote><p>Some commands cannot be executed in production without confirmation. These include all commands except <code>operations:status</code> and <code>operations</code>.</p></blockquote><p>Some operations are destructive, which means they may cause you to lose data. In order to protect you from running these commands against your production database, you will be prompted for confirmation before the commands are executed. To force the commands to run without a prompt, use the <code>--force</code> flag:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">php artisan operations:install <span class="token parameter variable">--force</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="execution-every-time" tabindex="-1"><a class="header-anchor" href="#execution-every-time"><span>Execution Every Time</span></a></h2><p>In some cases, you need to call the code every time you deploy the application. For example, to call reindexing.</p><p>To do this, override the <code>$once</code> variable in the operation file:</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token keyword">use</span> <span class="token package">DragonCode<span class="token punctuation">\</span>LaravelDeployOperations<span class="token punctuation">\</span>Operation</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token keyword">class</span> <span class="token class-name-definition class-name">extends</span> <span class="token class-name">Operation</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">protected</span> <span class="token keyword type-declaration">bool</span> <span class="token variable">$once</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">void</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// some code</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>If the value is <code>$once = false</code>, the <code>up</code> method will be called every time the <code>operations</code> command called.</p><p>In this case, information about it will not be written to the <code>operations</code> table and, therefore, the <code>down</code> method will not be called when the rollback command is called.</p><blockquote><p>Note</p><p>When using the <code>before</code> parameter to run command, it is recommended to override the value of the <code>$before</code> attribute to <code>false</code>, otherwise this operation will be executed twice.</p></blockquote><h2 id="execution-in-a-specific-environment" tabindex="-1"><a class="header-anchor" href="#execution-in-a-specific-environment"><span>Execution In A Specific Environment</span></a></h2><p>In some cases, it becomes necessary to execute an operation in a specific environment. For example <code>production</code>.</p><p>For this you can use the <code>$environment</code> parameter:</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token keyword">use</span> <span class="token package">DragonCode<span class="token punctuation">\</span>LaravelDeployOperations<span class="token punctuation">\</span>Operation</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token keyword">class</span> <span class="token class-name-definition class-name">extends</span> <span class="token class-name">Operation</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">protected</span> <span class="token keyword type-declaration">string</span><span class="token operator">|</span><span class="token keyword type-declaration">array</span><span class="token operator">|</span><span class="token keyword type-declaration">null</span> <span class="token variable">$environment</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&#39;production&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">void</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// some code</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>You can also specify multiple environment names:</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token keyword">use</span> <span class="token package">DragonCode<span class="token punctuation">\</span>LaravelDeployOperations<span class="token punctuation">\</span>Operation</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token keyword">class</span> <span class="token class-name-definition class-name">extends</span> <span class="token class-name">Operation</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">protected</span> <span class="token keyword type-declaration">string</span><span class="token operator">|</span><span class="token keyword type-declaration">array</span><span class="token operator">|</span><span class="token keyword type-declaration">null</span> <span class="token variable">$environment</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;testing&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;staging&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">void</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// some code</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>By default, the operation will run in all environments. The same will happen if you specify <code>null</code> or <code>[]</code> as the value.</p><h2 id="execution-excluding-certain-environments" tabindex="-1"><a class="header-anchor" href="#execution-excluding-certain-environments"><span>Execution Excluding Certain Environments</span></a></h2><p>In some cases, it becomes necessary to execute an operation excluding certain environments. For example <code>production</code>.</p><p>For this you can use the <code>$except_environment</code> parameter:</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token keyword">use</span> <span class="token package">DragonCode<span class="token punctuation">\</span>LaravelDeployOperations<span class="token punctuation">\</span>Operation</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token keyword">class</span> <span class="token class-name-definition class-name">extends</span> <span class="token class-name">Operation</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">protected</span> <span class="token keyword type-declaration">string</span><span class="token operator">|</span><span class="token keyword type-declaration">array</span><span class="token operator">|</span><span class="token keyword type-declaration">null</span> <span class="token variable">$exceptEnvironment</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&#39;production&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">void</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// some code</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>You can also specify multiple environment names:</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token keyword">use</span> <span class="token package">DragonCode<span class="token punctuation">\</span>LaravelDeployOperations<span class="token punctuation">\</span>Operation</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token keyword">class</span> <span class="token class-name-definition class-name">extends</span> <span class="token class-name">Operation</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">protected</span> <span class="token keyword type-declaration">string</span><span class="token operator">|</span><span class="token keyword type-declaration">array</span><span class="token operator">|</span><span class="token keyword type-declaration">null</span> <span class="token variable">$exceptEnvironment</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;testing&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;staging&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">void</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// some code</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>By default, no operations will be excluded. The same happens if you specify <code>null</code> or <code>[]</code> value.</p><h2 id="database-transactions" tabindex="-1"><a class="header-anchor" href="#database-transactions"><span>Database Transactions</span></a></h2><p>In some cases, it becomes necessary to undo previously performed operations in the database. For example, when code execution throws an error. To do this, the code must be wrapped in a transaction.</p><p>By setting the <code>$transactions = true</code> parameter, you will ensure that your code is wrapped in a transaction without having to manually call the <code>DB::transaction()</code> method. This will reduce the time it takes to create the operation.</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token keyword">use</span> <span class="token package">DragonCode<span class="token punctuation">\</span>LaravelDeployOperations<span class="token punctuation">\</span>Operation</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token keyword">class</span> <span class="token class-name-definition class-name">extends</span> <span class="token class-name">Operation</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">void</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// some code</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">hasTransactions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">bool</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">transactionAttempts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">int</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token number">4</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="asynchronous-call" tabindex="-1"><a class="header-anchor" href="#asynchronous-call"><span>Asynchronous Call</span></a></h2><p>In some cases, it becomes necessary to execute operations in an asynchronous manner without delaying the deployment process.</p><p>To do this, you need to override the <code>async</code> method in the operation class:</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token keyword">use</span> <span class="token package">DragonCode<span class="token punctuation">\</span>LaravelDeployOperations<span class="token punctuation">\</span>Operation</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token keyword">class</span> <span class="token class-name-definition class-name">extends</span> <span class="token class-name">Operation</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">void</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// some code</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">isAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">bool</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>In this case, the operation file that defines this parameter will run asynchronously using the <code>DragonCode\LaravelDeployOperations\Jobs\OperationJob</code> class.</p><p>The name of the connection and queue can be changed through the <a href="https://github.com/TheDragonCode/laravel-deploy-operations/tree/main/config" target="_blank" rel="noopener noreferrer">settings</a>.</p><p>::: Info We remind you that in this case the <a href="https://laravel.com/docs/queues" target="_blank" rel="noopener noreferrer">queuing system</a> must work in your application.</p><p>Using Laravel version 8.37 and above, checking for the <a href="https://laravel.com/docs/10.x/queues#unique-jobs" target="_blank" rel="noopener noreferrer">uniqueness</a> of the execution is supported. :::</p></div><!--[--><!--]--></div><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link label" href="https://github.com/TheDragonCode/laravel-deploy-operations/edit/main/docs/guide/running.md" aria-label="Edit this page" rel="noopener noreferrer" target="_blank"><!--[--><svg class="edit-icon" viewbox="0 0 1024 1024"><g fill="currentColor"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></g></svg><!--]-->Edit this page<!----></a></div><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><!----></div></footer><nav class="vp-page-nav" aria-label="page navigation"><!----><a class="route-link auto-link next" href="/guide/creating.html" aria-label="Creating Operations"><div class="hint">Next <span class="arrow right"></span></div><div class="link"><span>Creating Operations</span></div></a></nav><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-DbZK4p7a.js" defer></script>
  </body>
</html>
